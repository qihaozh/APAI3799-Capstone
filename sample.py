"""
Sample: ä½¿ç”¨ Gemini 2.0 Flash è¿è¡ŒåŒ»ç–—å¯¹è¯æ¨¡æ‹Ÿ
==============================================
è¿è¡Œå‰è¯·ç¡®ä¿:
  1. pip install google-genai
  2. è®¾ç½®ä½ çš„ Google API Keyï¼ˆä¸‹æ–¹ç›´æ¥å¡«å…¥æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ GOOGLE_API_KEYï¼‰
"""

from med_dialog_simulator import MedDialogSimulator, GeminiBackend

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# é…ç½®
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
API_KEY = "AIzaSyCx3Oq8F8g2Yp_khPJ2LFa1UfdwPO12BV8"  # â† æ›¿æ¢ä¸ºä½ çš„ API Key
MODEL = "gemini-3-flash-preview"      # Gemini 3 Flash (preview)
DATASET_DIR = "Medical-Dialogue-Dataset-Chinese"
DATA_FILE = "2020.txt"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 1. åˆå§‹åŒ–åç«¯ & æ¨¡æ‹Ÿå™¨
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
backend = GeminiBackend(api_key=API_KEY, model=MODEL)
sim = MedDialogSimulator(dataset_dir=DATASET_DIR, backend=backend)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 2. åŠ è½½æ•°æ® â€” ä» 2020.txt åŠ è½½å‰ 20 æ¡è®°å½•
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
records = sim.load_records(DATA_FILE, limit=20)
print(f"âœ… å·²åŠ è½½ {len(records)} æ¡è®°å½•\n")

# é¢„è§ˆä¸€æ¡è®°å½•çš„åŸºæœ¬ä¿¡æ¯
rec = records[3]
print(f"ğŸ“‹ é€‰ä¸­è®°å½• ID={rec.record_id}")
print(f"   ç–¾ç—…: {rec.disease}")
print(f"   åŒ»é™¢: {rec.hospital} - {rec.department}")
print(f"   çœŸå®å¯¹è¯è½®æ•°: {len(rec.dialogue)}\n")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 3. è‡ªåŠ¨æ¨¡æ‹Ÿå¯¹è¯ (AI åŒæ—¶æ‰®æ¼”åŒ»ç”Ÿå’Œæ‚£è€…)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
print("ğŸ”„ æ­£åœ¨ä½¿ç”¨ Gemini 3.0 Flash æ¨¡æ‹Ÿå¯¹è¯...\n")
result = sim.simulate(rec, max_turns=8, mode="auto")
print(result.formatted())

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 4. (å¯é€‰) æ‰¹é‡æ¨¡æ‹Ÿå¤šæ¡è®°å½• & å¯¼å‡º
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# results = sim.batch_simulate(records[:5], max_turns=6, mode="auto")
# sim.export_results(results, "output/simulated.json", format="json")
# sim.export_results(results, "output/simulated.txt", format="txt")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# 5. (å¯é€‰) äº¤äº’æ¨¡å¼ â€” ä½ æ‰®æ¼”æ‚£è€…ï¼ŒAI æ‰®æ¼”åŒ»ç”Ÿ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# sim.interactive_chat(rec, user_role="patient")